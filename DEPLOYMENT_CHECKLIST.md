# üöÄ Deployment Checklist - Wolf Goat Pig

## ‚úÖ Pre-Deployment Fixes Applied

### Fixed Critical Issues:
- [x] **API URL Consistency** - All configs now use `https://wolf-goat-pig-api.onrender.com`
- [x] **Requirements Path** - Fixed `render.yaml` to use `backend/requirements.txt`
- [x] **Vercel Build Config** - Updated build command for frontend structure

## üîç Deployment Verification Steps

### 1. **Backend Deployment (Render)** üêç

#### Environment Variables to Set in Render Dashboard:
```
DATABASE_URL=<auto-generated by Render PostgreSQL>
PYTHON_VERSION=3.12.8
ENVIRONMENT=production
FRONTEND_URL=https://wolf-goat-pig.vercel.app
GHIN_API_USER=<optional>
GHIN_API_PASS=<optional>
GHIN_API_STATIC_TOKEN=<optional>
```

#### Health Check Verification:
```bash
curl https://wolf-goat-pig-api.onrender.com/health
# Expected: {"status":"healthy","timestamp":"2024-XX-XXTXX:XX:XX.XXXXXX"}
```

#### Critical Endpoints to Test:
- `GET /health` - Health check
- `GET /rules` - Game rules
- `GET /game/state` - Game state
- `POST /game/action` - Game actions
- `GET /simulation/run` - Simulation endpoint

### 2. **Frontend Deployment (Vercel)** ‚öõÔ∏è

#### Environment Variables to Set in Vercel Dashboard:
```
REACT_APP_API_URL=https://wolf-goat-pig-api.onrender.com
NODE_ENV=production
```

#### Build Command Verification:
- Vercel should run: `cd frontend && npm ci && npm run build`
- Build output should be in `frontend/build/`

#### Routing Test:
- `/` - Home page
- `/game` - Game interface  
- `/simulation` - Monte Carlo simulation
- `/analytics` - Shot analyzer

### 3. **CORS Configuration** üåê

Current allowed origins:
```python
# Production CORS origins
[
    "https://wolf-goat-pig-frontend.onrender.com",  # Render frontend (backup)
    "https://wolf-goat-pig.vercel.app",             # Vercel frontend (primary)
    "http://localhost:3000"                         # Local development
]
```

**Test CORS:**
```bash
curl -H "Origin: https://wolf-goat-pig.vercel.app" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: X-Requested-With" \
     -X OPTIONS \
     https://wolf-goat-pig-api.onrender.com/game/state
```

### 4. **Database Connectivity** üóÑÔ∏è

**PostgreSQL on Render:**
- Service: `wolf-goat-pig-db`
- Region: Oregon
- Plan: Free
- Auto-generated `DATABASE_URL` passed to backend

**Test Database:**
```python
# Should work in production
from app.database import init_db
init_db()  # Creates tables if they don't exist
```

### 5. **Security Headers** üîí

**Vercel Security Headers:**
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`

**Render Backend Security:**
- TrustedHost middleware enabled
- CORS properly configured
- Health check on `/health`

## üö® Common Deployment Issues & Solutions

### Issue 1: "Module not found" errors in backend
**Solution:** Ensure `backend/requirements.txt` includes all dependencies:
```txt
fastapi==0.110.0
uvicorn[standard]==0.29.0
SQLAlchemy==2.0.30
psycopg2-binary==2.9.9
python-multipart==0.0.9
httpx==0.27.0
python-dotenv==1.0.1
pydantic==2.6.0
```

### Issue 2: Frontend build fails
**Solution:** Check `frontend/package.json` scripts:
```json
"scripts": {
  "build": "react-scripts build"
}
```

### Issue 3: CORS errors in browser
**Solution:** Verify frontend URL matches CORS origins in backend

### Issue 4: Database connection fails
**Solution:** Check `DATABASE_URL` environment variable format:
```
postgresql://user:password@host:port/database
```

### Issue 5: Health check fails
**Solution:** Ensure `/health` endpoint returns 200 status

## üìä Monitoring & Alerts

### Backend Monitoring (Render):
- Health check every 30 seconds on `/health`
- Auto-restart on failure
- Logs available in Render dashboard

### Frontend Monitoring (Vercel):
- Edge caching for static assets
- Automatic HTTPS
- Global CDN deployment
- Analytics in Vercel dashboard

### Performance Targets:
- Backend response time: < 500ms
- Frontend load time: < 2 seconds
- Database query time: < 100ms
- Uptime: 99.9%

## üîß Troubleshooting Commands

### Backend Logs:
```bash
# View Render logs (through dashboard)
# Check for startup errors, database connections, CORS issues
```

### Frontend Logs:
```bash
# View Vercel deployment logs (through dashboard)
# Check for build errors, missing environment variables
```

### Local Testing:
```bash
# Test backend locally
cd backend && uvicorn app.main:app --reload

# Test frontend locally
cd frontend && npm start

# Test production build locally
cd frontend && npm run build && npx serve -s build
```

## ‚úÖ Final Deployment Steps

1. **Commit all configuration changes**
2. **Push to GitHub main branch**
3. **Verify Render auto-deploys backend**
4. **Verify Vercel auto-deploys frontend**
5. **Test all endpoints and routes**
6. **Monitor logs for 24 hours**
7. **Set up alerts for downtime**

---

**Last Updated:** 2025-08-05  
**Status:** Configuration Fixed - Ready for Deployment